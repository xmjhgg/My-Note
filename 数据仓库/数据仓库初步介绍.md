# 数据仓库介绍
## 数据仓库的演化历史
### 最初的数据存储
数据仓库的历史可以从最早的数据存储开始说起，最初程序的数据是通过磁带来存储，磁带存储的弊端是只能磁带只能顺序访问，程序执行时真正需要的数据可能只有5%，但是却需要顺序的从头访问整个文件，直到找到程序需要的数据，并且磁带文件的访问速度很慢，访问整个磁带文件可能需要20-30分钟。  
### 直接存储设备
后来出现了一种新的数据存储和访问技术：直接存取存储设备（Direct Access Storage Device，以下简称DASD），也就是我们现在熟知的磁盘存储。DASD和磁带文件的根本不同在于DASD可能直接对数据进行访问。只要程序事先知道了要访问的记录所在磁盘地址，程序就可以直接访问这条记录。并且DASD的顺序遍历速度也比磁带文件快的多，通常一次访问是使用毫秒来作为计量单位的
### 数据库
随着DASD技术的发展，就出现了一种称为数据库管理系统的新型软件，也就是现在大家比较熟知的数据库。数据库的目的是让程序员可以更方便的在DASD上存储和访问数据。数据库负责存储数据、对数据进行索引等等功能；  

### 抽取程序
随着数据库技术以及在线事务处理（Online Transaction Processing，以下简称OLTP）技术的发展，人们开始使用数据做更多的事情，通过“抽取”程序，来对数据库中的符合某些条件的数据抽取出来，用于实现了早期的决策支持系统（Decision Support System，简称DSS），一种用来帮助支持业务或组织进行决策的信息系统。
- 为什么使用抽取程序  
  1. 将数据从一个数据库中抽取到另一个环境中，这样对数据进行分析时不会影响原来数据库的性能
  2. 当数据从某部门被另外一个部门抽取出来后，这个数据就属于另外一个部门，通常大家都会乐意拥有数据  

  所以抽取程序的应用十分普遍

#### 抽取程序的演化弊端
随着抽取程序的普遍应用，就会产生一张抽取的蜘蛛网：
![](./img/dw/%E8%9C%98%E8%9B%9B%E7%BD%91.png)
最初只是从数据库上进行抽取，后来则是在抽取后的数据上再抽取...  
这种失控的抽取程序演化会带来以下几个问题：
- 数据缺失可信度  
A部们通过抽取程序呈现的报表说业绩上升了10%，而B部门说业绩下降了15%，这种情况下很难确定到底哪个报表是正确的，导致数据失去的可信度  
这种情况的产生通常有以下四个原因：  
  - 数据的时间范围不同  
    A部门从周天晚上开始提取分析所需数据，B部门则从周三开始提取分析所需数据，
    对于在线事务处理系统，数据通常在不停的变换，两个部门从不同的时间点提取分析后产生的报表往往是有所差异  
  - 抽取算法上的差异  
    可能两部门的分析角度不同，一个部门抽取的是福建省的用户、另一个部分则抽取上海的用户  
  - 抽取的层次不同  
    A部门的报表可能经过5次的抽取，B部门的报表经过8次抽取，并且每次抽取还会被上面两个因素影响，导致最后的两个部门呈现的报表偏差更大  
  - 没有公共的数据源  
    A部门的抽取程序从A库开始，B部门则从B库开始，A B库之间通常不存在数据同步，所以最终产生的报表也会有偏差
- 生产率问题  
  当管理者想用数年积累的数据来生成一张企业级别的报表时，由于数据分散在各个数据库、抽取程序中，导致为了制作这张报表需要大量的时间，承担此任务的人要做两件事：
  - 找到报表需要的数据并分析  
    这一步需要定位报表需要的数据在哪，有些数据可能存在A库、有些数据存在B库。并且存储的设施还不一样，可能是Mongo、ES、Mysql，需要通过不同的技能组合才能进行定位，而且在分析数据时，可能同样名字的字段在不同库的含义完全不同。这是一个漫长而乏味的过程  
    ![](./img/dw/%E7%94%9F%E4%BA%A7%E7%8E%87%E9%97%AE%E9%A2%98.png)
  - 设计开发此报表  
  此步骤依旧很难，因为需要从众多的数据源中取得数据
    - 要写的程序很多，并且每个程序通常都是定制开发
    - 程序涵盖了公司所需要的所有技术

并且上面两个步骤在每次有新的报表需求时都需要重复的进行（报表与报表之间通常没有关联,不能利用已有的报表），生产率非常低

- 无法将数据转化为信息  
  比如想从众多存储交易信息数据源中得到这样一个信息：“企业最近十年的用户下单情况”
  面对这个需求开发人员需要在现有的大量系统中寻找所需要的数据，那就不得不面对历史所遗留下来的系统，有的系统可能是多年前开发，在开发时从没有考虑过数据集成的问题，不能进行抽取等；  
  并且有的系统没有存储历史的数据，可能有的系统只存储当年的订单。

### 数据仓库体系
上面的抽取程序的演化确实不能满足将来的数据分析需求，于是出现了现在的数据仓库体系   

在数据仓库体系环境下，主要包含两种数据：原始数据（操作型数据）和导出数据（数据分析型数据）
两种数据的主要区别：
![](./img/dw/%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E5%92%8C%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8C%BA%E5%88%AB.png)
- 原始数据  
  是维持系统进行日常业务操作所需要的细节性数据
- 导出数据  
  经过汇总或者计算来满足DSS需要的数据  

#### 数据仓库体系下的数据存储与展现
在这种体系结构有四个层次的数据存储：
![](./img/dw/%E5%9B%9B%E4%B8%AA%E5%B1%82%E6%AC%A1.png)
- 操作层  
  只包含了面向业务应用的原始数据，并且主要服务于OLTP
- 数据仓库层  
  存储数据的历史变化过程，同时也会存储一部分的汇总数据
- 部门/数据集市层  
  根据管理者的特殊需求建立，通常是一些报表需要的汇总数据
- 个体层  
  用于帮助管理者进行启发式的分析，通常就是根据需要对数据仓库仓库/数据集市进行筛选然后得到一个子的数据集，也可以理解为报表层

以一个银行的顾客主题数据为例子，对应的四个层次内的数据存储为：
![](./img/dw/%E5%9B%9B%E4%B8%AA%E5%B1%82%E6%AC%A1%E4%BE%8B%E5%AD%90.png)

- 数据仓库体系下的数据集成  

  上面说明了数据仓库体系数据是如何存储的，在数据仓库体系下还有一个重要的部分就是将操作型系统的数据集成到数据仓库中。  
  在数据仓库体系下依靠ETL软件来进行集成，集成并不是简单的将原来的数据丢到数据仓库中，而是需要经过一系列的处理,并最后放入到对应的主题域中，ETL这一部分在后续的文章中说明  

  一个数据集成例子：
  ![](./img/dw/%E6%95%B0%E6%8D%AE%E9%9B%86%E6%88%90%E4%BE%8B%E5%AD%90.png)
- 数据仓库的定义（个人理解）  
  数据仓库并不是一个简单的存储数据的数据库而是一整套系统体系结构，这一套体系下由以下几个部分组成：源数据系统（操作层）、ETL系统、数据存储（数据仓库层）、数据展现（数据集市、个体层）  
至此，当报表开发人员、或者数据分析人员要分析数据时，只要到数据仓库内根据主题就可以很快的找他要的数据，并且数据仓库还提供了各种汇总数据、维度等方便使用者进行分析 

## 事务操作型系统(OLTP)和数据仓库(OLAP)的区别
- 存储的数据区别
事务操作性系统的数据通常是面向业务应用的，因此是非集成的，一般只有当前数据的最新状态  
数据仓库内的数据则必须是集成的，可以观察到数据的历史变化
- 开发生命周期的区别  
事务操作性系统的开发生命周期通常传统的瀑布式开发，从收集需求-分析-设计-编码-测试-集成-发布，也就是需求驱动开发生命周期  
而数据仓库则和瀑布书开发相反：一开始就得到数据，将数据集成到数据仓库中，校准数据，然后编写程序分析数据，分析程序的执行结果才得到系统需求，理解了系统需求后再对数据仓库进行调整，开始新一轮的开发周期。这是一种数据驱动开发生命周期
- 硬件的利用模式不同  
  事务操作型的硬件利用通常是比较稳定的，只要公司的业务比较稳定，电脑CPU、内存等利用率也会处于一个平均的状态
  数据仓库的硬件利用率则并不稳定，在需要分析时CPU、内存的利用率可以达到很高，不需要分析时则几乎为0
  ![](./img/dw/%E7%A1%AC%E4%BB%B6%E5%88%A9%E7%94%A8%E7%9A%84%E5%8C%BA%E5%88%AB.png)


## 数据仓库的特性
- 面向主题  
  主题是什么：将企业不同的业务流程进行汇总、分类，对其进行分析利用的一个抽象概念，汇总分类后得到的分类结果就是主题。比如将下单、发货、退款等业务流程汇总成交易主题域；对于一个生产商来说，主题域与可能是产品、定单、销售商等；对于一个零售店来说、主题域可能是产品、库存、顾客等；不同类型的公司其数据仓库拥有的主题集合是不同的  
  数据仓库将数据按照数据的主题来进行组织、存储

- 集成  
  数据仓储的数据通常从事务操作型数据源中传送过来的，这些数据进入数据仓库时会经过一系列的处理：去除异常数据、统一数据形式、度量单位等等，才能将面向事务的数据转换成数据仓库所需要的面向主题的数据，而不是直接简单的放到数据仓库中。数据集成是数据仓库中最重要，也是最为复杂的一步。


- 非易失  
  数据仓库中的数据是为管理决策使用，通常需要分析数据的历史变化，因此数据仓库内的数据通常情况下不进行直接的修改，数据仓库内进行数据修改通常是依靠增加一条新的快照数据来完成

- 时变性  
  时变性是指数据仓库中的每个数据只在某一时间是准确的，通常数据仓库内的数据都会包含某种形式的时间标志来说明数据在哪个时间是准确的

## 数据仓库架构
- Kimball数据仓库架构
  Kimball架构将数据仓库划分为4个部分：操作型源系统、ETL系统、数据展现区、BI应用
  ![](./img/dw/kimball%E6%9E%B6%E6%9E%84.png)

  - 操作型源系统  
    指的就是各种面向功能的业务系统，数据仓库的数据来源
  - ETL系统：  
    数据仓库对操作型源系统进行ETL部分功能的系统
  - 数据展现区  
    数据展现区用于数据仓库组织、存储数据，支持用户、报表开发人员、数据分析师对这一块数据进行查询。  
    维度建模就是作用在这一块的数据区域，这一部分会存储细粒度的数据，也会存储部分汇总数据，还有各种维度模型
  - BI应用  
    BI应用区利用数据展现区的数据来提供指定分析决策的能力，面向的人员是商业用户


- Inmon数据仓库架构  
  Inmon数据仓库架构分为：操作型源系统、ETL、企业数据仓库、数据集市、BI应用  
  ![](./img/dw/inmon%E6%9E%B6%E6%9E%84.png)
  Inmon架构有一些和Kimball架构相同的部门：操作型源系统、ETL、BI应用，并且都将操作型系统和分析型系统分离  

  不同的部分：
  - 企业数据仓库：
  原子粒度数据的集成仓库，这一部分存储的数据会遵守第三范式
  - 数据集市：  
  是针对不同的主题域，从企业数据仓库中获取的信息，然后通过聚集、计算，最后提供最终用户分析使用，也因此从企业数据仓库移动到数据集市的过程描述为“数据发布”。


- 两者之间的区别  
  1. 两种架构中最大区别是，Inmon架构中对于数据的存储,也就是企业数据仓库这一部分，没有体现维度建模的概念，数据的存储遵守第三范式，里面会有各种实体表和实体之间的关系表；而Kimball架构中的数据展现区存储的数据则是采用维度建模方法，里面会有各种维度表与事实表，并且对于事实表结构和维度表结构更推荐反范式
  2. Inmon架构中比Kimball架构中多出一个围绕部门级别建立的汇总数据的数据集市，而Kimball架构中则将这一部分汇总数据也算入在数据展现区内
# 小结
文章从数据存储的演化开始介绍数据仓库，从最初数据存储在磁带到现在的数据仓库体系。  
后面介绍了OLTP与OLAP的区别:  存储的数据特性不同、开发生命周期不同、硬件的利用模式不同。数据仓库的几个特性：面向主题的、集成的、非易失、时变性  
最后介绍了两种数据仓库架构：一个是维度建模专家kimball提出的架构，另一个则是数据仓库之父Bill Inmon提出的架构。

| 参考资料：  
  《数据仓库》第1-2章  

  《数据仓库工具箱》第1章