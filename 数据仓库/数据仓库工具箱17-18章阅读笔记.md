# DW/BI 生命周期概述
Kimball生命周期是一个用于指导数据仓库开发过程的方法  
生命周期图例：  
![](./img/dmtoolkit/kimball%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE%E4%BE%8B.png)

其中技术结构设计、维度建模、BI应用设计为三个并行模块，下面详细介绍生命周期的各个过程
## 生命周期初始

### 程序/项目规划与管理

#### 1.DW/BI项目评估
在要开发DW/BI项目之前，首先应该要评估下DW/BI项目的成功率：
影响DW/BI项目最终是否能够成功的最重要的三个因素
1. 有一个强有力的项目执行主管，并对DW/BI系统对公司的潜在影响有清晰的认识，能够说服其他领导来建立DW/BI系统。
2. DW/BI项目有一个引人注目的开发动机，能够解决关键的业务问题。这样DW/BI项目才能为获得成功和一个健康的生命周期拥有足够的资源。
3. 评估操作型系统中的数据可行性。数据可行性相比于技术可行性、资源可行性相比最为重要，如果实际的操作型源系统不能够支持DW/BI的业务需求，那么DW/BI项目将很难在短时间完成（可能需要先等操作型源系统进行调整满足了DW/BI的业务需求，DW/BI项目才能进行开发），评估的方式可以使用数据探查的一种数据分析手段，可以判断操作型系统中的数据是否特别脏，是否需要进行比较复杂的数据预处理。

#### 2.确定项目边界、项目论证
- 确定项目边界：  
确定哪些工作是项目内的，哪些工作不在项目内  
- 项目论证：  
对DW/BI项目的利益与成本分析。和大部分的操作型系统相比，DW/BI对于资源的需求不会随着时间的推移而显著下降，DW/BI需要不断的维护、拓展。

#### 3.确定人员配备
DW/BI项目需要集成不同的业务和不同的IT技术，因此DW/BI项目需要不同的角色来参与开发  
- 决策人员： 
业务发起人/业务驱动者：业务发起人是DW/BI系统的最终客户，也是系统最强大的支持者。  
在一些大型企业里，业务发起人可能地位比较高不直接和项目组交流，这种时候发起人会将这个任务交给其他人，这个人就是业务驱动者，这种时候业务驱动者和业务发起人具有同样的特征。  
- DW/BI主管  
DW/BI主管是业务发起人的辅助角色，也是业务发起人和DW/BI团队之间联系的纽带，主要负责设计和宣传商务报告。承担横跨多个项目的职责，负责整个项目计划和环境的全局领导和指导。这一角色有时还被称为信息总管CIO、首席运营官COO、首席财务主管CFO。
- 指导者  
1. 项目经理：  
项目经理类似于球队的主教练，负责对DW/BI项目任务和各项活动进行细致的管理，包括人员协调、任务跟踪、项目进展、问题的沟通以及和业务项目领导者合作等。  
2. 业务项目领导者：
业务项目领导者是公司业务功能的代表，真正的了解各种业务需求，他与项目经理一起共事，共同监控项目的进展情况并与DW/BI项目团队保持紧密联系。  
根据公司的大小不同，业务驱动着和业务项目领导者可能由同一个人担任。  
- DW/BI项目核心团队角色  
1. 业务分析员：  
业务分析员负责对业务需求进行定义，将这些需求转换为技术架构、维度模型、BI应用。  
业务分析员经常由能够以用户为中心来考虑问题并且对业务非常熟悉的人来担任，对于小型项目来说可能会由项目经理或业务项目领导者来同时担任。  
2. 数据管理员/数据质量保证分析人员：  
数据管理员负责管理整个公司在业务中、数据仓库中数据的允许值范围。  
数据管理员通常和数据质量保证人员一起工作，质量保证分析员负责确保载入数据仓库的数据是准确和完整的，如果他识别出了数据错误，那么他需要通知源系统进行修改然后通过数据仓库的ETL系统来修复。  
3. 数据设计师/建模者/数据库管理员：  
- 数据设计师负责设计维护DW/BI系统的数据仓库总线架构
- 建模者负责进行详细的数据分析和建立维度模型
- 数据库管理员：负责将维度模型转换为数据库中表  
4. 元数据管理员  
负责管理数据仓库中的元数据，这个人对于要收集什么样的元数据、将元数据保存在哪、用什么方式来发布元数据有最终的发言权。
5. ETL设计师/ETL开发人员  
ETL设计师负责对ETL系统进行架构设计。  
ETL开发人员在ETL设计师的指导下进行开发。  
6. BI应用设计/开发人员  
负责设计/开发BI应用

#### 4.规划项目
规划项目指确定所有生命周期内的必要的任务、确定主要的项目里程碑、估计不同任务的开发工作量

### 业务需求定义
要构建一个成功的 DW/BI 系统，最重要的工作是与商业用户紧密合作，了解他们的需求并确保他们的投入是有价值的。
#### 1.收集业务需求
这一部分是开始面对面收集需求的时候，过程按照结构化问询并最终形成文档这一流程：  
1. 初启：  
在开始询问需求前，首先应当指定本次会议的负责人，负责人简单描述本次会议的谈论要点并简单明确的传达以用户业务为中心的信息，不要漫无边际地介绍说明硬件、软件或者其他技术等
2. 访谈：  
访谈的目标是让业务用户说清楚他们做什么和为什么要做。询问一些受访者的关键度量、维度，确定他们是如何将这些指标直接放入到他们的数据库中，比如“您如何区分不同的产品（或代理商 、供应商或设施）？” 或 “如何自然地分类产品？”。如果受访者是比较偏向于分析，那么最好让他带上关键图表和报表。  
3. 形成最终文档：  
在访谈进入最后总结阶段时，请每个受访者提出对于DW/BI是否成功的关键评判标准。受访者需要提出清晰的细节，比如，他们能够接受BI报告的延迟是多久、查询一次BI报表需要多长时间等，而不是易于使用、快捷等模糊的词语。
4. 文档化需求：  
访谈后紧接着需要做的事情：访谈小组应完成详细的访谈报告。确认每个小组成员所记录的内容。如果每个人都能在会议后，趁对访谈内容尚具有清晰记忆时，快速总结自己的笔记是非常有用的，这样做可以填补空白。笔记中一些的缩略词和记录不全的句子在几天后会变得难以理解。  
5. 确定需求优先级：  
在开发DW/BI系统时，难以避免的事就是很难通过一次迭代就涵盖了所有的用户需求，因此需要先考虑需求的实现顺序

## 生命周期技术路径
### 1.技术架构设计  
技术架构是描绘 DW/BI 系统的技术服务和基础设施的蓝图技术架构包含一系列揭示每个主要部件细节的模型，也就是包含真正使用到的设施的更为详细的kimball数据仓库架构图

- 技术架构设计流程：
1. 建立架构工作组  
通常由ETL设计师和BI应用设计来组成，这两个人足以代表数据仓库中的后端和前端  
2. 收集与架构有关的需求
在技术架构设计上的关键输入来自业务需求的定义。技术构架设计主要关注那些能够对架构产品影响的业务需求，比如时间、可用性、性能等方面的需求。  
并且还应该通过召开IT部门的内部访谈会来理解当前公司所拥有的技术，并了解操作型系统对于为了配合DW/BI系统进行调整的意愿。
3. 架构需求文档化  
在收集完业务需求和IT部门内的访谈后，需要对需求进行文档化，可以用使用简单的图标形式列出会影响架构的业务需求，以及受到影响的架构部门。比如如果需要每天晚上发布商品销售数据，那么技术架构就需要保证7x24小时的可用性。  
4. 建立概要的架构模型  
在文档化需求后，架构工作组的人员就应该开始划分架构中的主要组件包括 ETL 、BI 、元数据 和基础设施等，并开始建立概要的架构模型。  
5. 确定架构实现阶段  
技术架构中的方方面面通常在第一次迭代中难以全部实现，所以还需要根据业务需求来设定架构实现的顺序，提供在项目初期提供包含最少元素的架构  
6. 设计并定义子系统  
架构中需要的大部分功能可能可以通过现有的设施实现，但是总由一些子系统需要自己实现，这一部分需要架构进组进行详细的设计  
7. 输出架构详细文档  
建构详细文档中应该包括十分详细的细节  
8. 评审与确定技术架构  

### 2.产品选择与安装
技术架构确定后，就开始确定要选择什么产品来实现技术架构  
产品的选择通常会涉及到以下几个产品：  
- 硬件平台  
- DBMS平台  
- ETL工具  
- BI工具  

#### 产品的选择安装流程
1. 了解公司的采购流程
2. 建立产品评价矩阵  
通过一个电子图标来用于确定评价准则以及产品体验结果，评价准则越具体越好。如果太过模糊，那么很难对比不同的产品  
3. 进对产品进行市场调研  
4. 详细评估的产品  
详细评估产品之前，需要通过比较评价矩阵的基本得分来筛选得分较高的产品来进行详细评估  
5. 安装实验与谈判


## 生命周期数据路径
### 1.维度建模  
参考之前的维度建模4步骤，下一章会详细介绍  
### 2.维度建模的物理设计
这一步主要是将维度模型转换为数据库的物理模型  

#### 1.制定物理模型规范  
DW/BI系统中的各个组件应该在全系统范围范围内制定组件标准并始终如一的贯彻执行标准，这可以使业务人员和开发人员能够在复杂的系统中比较方便的寻找他所需要的数据。  
通常情况下 物理模型的规范包含以下几点：
1. 遵守命名约定  
数据库中的表名和列名应当与维度模型中的名称相同，并且命名应该面向业务用户，便于他们理解与查找数据。  
表名和列表的命名风格应当保持一致。
- 比较推荐的两种命名方式：  
  1. 统一使用所有字母小写、单词之间用下划线分割，比如customer_key
  2. 使用HiLow方法命名，比如CustomerKey  
2. 避免在维度表中使用Null，最好为其赋予一个默认值，如“N/A”、“Not known”等  
3. 维度表的主键使用代理键  
4. 事实表的与维度表关联的外键不能为空    
#### 2.设计物理模型数据结构  
在开始设计物理模型之前，逻辑模型应该已经完成了。逻辑模型是物理模型的起始点，虽然物理模型和逻辑模型之间可能会因为物理模型要支持某些访问工具的特殊需求或者是为了改善查询性能而出现差异，但还是应该尽量保持物理模型和逻辑模型的相似。  

#### 3.物理模型表补充
在物理模型设计完成后，真实的物理表中要需要补充执行以下步骤  
1. 确保物理表的命名遵守命名约定  
2. 明确表是事实表还是维度表还是元数据表
3. 详细说明该物理表对应的哪些操作型系统源表，并简要描述数据转换的过程  
4. 确保物理表的列名遵守命名约定
5. 有选择的为某些列指定一个分组名，比如在客户维度中可能有十几个和地址相关列，十几个和客户名相关的列，那么可以将这些列指定分组名为客户地址、客户名 
6. 确保每个列都有正确的数据类型、长度、精度 
7. 规定每个缓慢变化维的处理技术  
8. 对每个列简要描述其相关的源系统与对应的转换方式，比如 “源 xx库.xx表.xx列从整数转换为字符串”  
9. 添加用于维护和审计的列，比如维度表中的某一列是采用类型2来处理维度变化，那么久应该为表添加生效日期、截止日期等  
  
#### 4.建立物理数据库表  
尽早根据物理模型建立物理数据库表，以便能够被ETL开发小组使用。同时这一步还需要做以下步骤：    
1. 建立索引
数据库管理员还应当对维度表、事实表建立正确的索引以提高性能  
2. 确定物理存储细节  
这一步骤包括是否对事实表按照日期分区、确定每个机器的磁盘大小、表空间大小、数据库具体的存储结构等进行设计

### 3.ETL设计与开发
数据路径最后结束于ETL的设计与开发

## 生命周期BI应用路径
尽管数据仓库能够提供完全随时、自助服务的数据分析查询环境，但是对于商业用户来说，这意味需要他们了解数据库结构、SQL等，BI应用才是他们访问DW/BI系统的唯一方式。  
BI应用应当满足以下设计需求：  
1. 正确。BI应用必须提供准确的审计报表和结果  
2. 性能良好。最好平均响应时间在5秒以内  
3. 易于使用。对于商业用户来说，在使用BI应用时最好不超过10次鼠标点击就能获得结果  
4. 外观漂亮。  
5. 能够长期迭代。BI应用必须适当的进行维护、增强、扩展  

### 1.制定BI应用规范
在开始设计BI应用时，建立BI应用的一系列规范是有非常有益的  
#### 1.制定BI应用的统一命名标准
这个命名标准中包含报表名、报表中的数据格式、多个报表中的公共字段名等等，这些标准有助于商业用户快速理解报表的本质：报表的内容、报表的来源、报表的时间。  

#### 2.建立统一的报表模板  
在确定了BI应用的命名标准后，应当开始建立一个通用统一的的报表模板，采用一致性的风格，商业用户可以更快找地找到他所需要的信息。  
一个报表通常会包含以下几个确定以下标准元素：  
1. 报表名  
2. 报表标题  
3. 报表的主体，报表数据行/列的展示的区域  
- 数据对齐：数值右对齐、行首左对齐、列首右对齐或居中等  
- 显示精度：数值字段需要显示相应的精度  
- 行列的格式：行列的格式需要便于和报表的数据区分开  
- 报表的背景色  
4. 页眉页脚  
以下几个元素应当在报表中的页眉或者页脚中出现  
- 报表名
- 报表的类别
- 报表运行时间和日期
- 报表数据源  
来自于数据仓库中的哪一个维度模型 

### 2.开发BI应用  
最后根据制定的BI应用规范与BI报表模板来开发BI应用


## 生命周期总结
生命周期总结是数据仓库生命周期的最后一部分，也就是数据仓库开发完成后的部署运行维护阶段，这一部份的主要工作是以下几点：  
1. 部署
2. 维护与发展  
  这一部分的主要工作包含以下几点  
  - 支持：部署后，为了确保用户能够喜欢使用，需要即使关注用户在使用上的是否存在问题，如果数据仓库内的数据有问题或者BI应用有错误被发现，应当立即采取行动来更正问题。  
  - 教育：持续的为DW/BI系统提供相关介绍使用文档  
  - 技术支持：在DW/BI系统的发展，需要同时保证DW/BI系统的性能  
  - 需求支持：DW/BI系统需要不断的迭代，确保DW/BI系统已有的数据和技术能够不断地解决用户的业务需求

## 常见错误
![](./img/dmtoolkit/10%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF.png)
## 小结
这一章浓缩了《数据仓库生命周期工具箱》这一本书的内容（不包含维度建模任务过程和ETL任务过程），介绍了一个数据仓库从起始到结束中应该要执行的任务。
